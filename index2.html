<!DOCTYPE html>
<html>
<head>
    <title>Lista de Tarefas com Prioridades</title>
    <style>
        .prioridadeSelecionada {
            font-size: 20px;
        }
        .tarefaRealizada {
            background-color: blue;
            color: white;
        }
        .tarefaVencida {
            background-color: red;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Minha Lista de Tarefas</h1>

    <h2>Prioridades:</h2>
    <button id="prioridadeAlta" style="background-color: red;" onclick="definirPrioridade('red')">Alta</button>
    <button id="prioridadeMedia" style="background-color: yellow;" onclick="definirPrioridade('yellow')">Média</button>
    <button id="prioridadeBaixa" style="background-color: green;" onclick="definirPrioridade('green')">Baixa</button>

    <input type="hidden" id="prioridade" value="green"> <!-- Valor padrão para a prioridade -->

    <input type="text" id="tarefa" placeholder="O Que Aconteceu ?">
    <input type="text" id="numeroOs" placeholder="Número de OS">
    <input type="text" id="placeholderConcatenar" placeholder="Setor:">

    <input type="text" id="responsavelInput" placeholder="Tarefa:"> <!-- Campo de responsável com o placeholder inicial "Tarefas" -->
    
    <!-- Adicione um campo de entrada de data -->
    <input type="date" id="dataVencimento" placeholder="Data de Vencimento">

    <button onclick="adicionarOuConcatenarTarefa()">Cadastar Atividade</button>

    <h2>Tarefas:</h2>
    <ul id="listaTarefas"></ul>

    <h2>Atividades em Andamento:</h2>
    <ul id="listaAtividadesEmAndamento"></ul>

    <h2>Atividades Realizadas:</h2>
    <ul id="listaAtividadesRealizadas"></ul>

    <script>
        var tarefas = []; // Array para armazenar as tarefas
        var atividadesEmAndamento = []; // Array para armazenar as atividades em andamento
        var atividadesRealizadas = []; // Array para armazenar as atividades realizadas

        // Função para salvar as tarefas no Local Storage
        function salvarTarefas() {
            localStorage.setItem("tarefas", JSON.stringify(tarefas));
        }

        // Função para salvar as atividades em andamento no Local Storage
        function salvarAtividadesEmAndamento() {
            localStorage.setItem("atividadesEmAndamento", JSON.stringify(atividadesEmAndamento));
        }

        // Função para salvar as atividades realizadas no Local Storage
        function salvarAtividadesRealizadas() {
            localStorage.setItem("atividadesRealizadas", JSON.stringify(atividadesRealizadas));
        }

        // Função para carregar as tarefas do Local Storage
        function carregarTarefas() {
            var tarefasSalvas = localStorage.getItem("tarefas");
            if (tarefasSalvas) {
                tarefas = JSON.parse(tarefasSalvas);
                exibirTarefas();
            }
        }

        // Função para carregar as atividades em andamento do Local Storage
        function carregarAtividadesEmAndamento() {
            var atividadesEmAndamentoSalvas = localStorage.getItem("atividadesEmAndamento");
            if (atividadesEmAndamentoSalvas) {
                atividadesEmAndamento = JSON.parse(atividadesEmAndamentoSalvas);
                exibirAtividadesEmAndamento();
            }
        }

        // Função para carregar as atividades realizadas do Local Storage
        function carregarAtividadesRealizadas() {
            var atividadesRealizadasSalvas = localStorage.getItem("atividadesRealizadas");
            if (atividadesRealizadasSalvas) {
                atividadesRealizadas = JSON.parse(atividadesRealizadasSalvas);
                exibirAtividadesRealizadas();
            }
        }

        // Função para exibir as tarefas na lista
        function exibirTarefas() {
            var listaTarefas = document.getElementById("listaTarefas");
            listaTarefas.innerHTML = "";

            for (var i = 0; i < tarefas.length; i++) {
                var tarefa = tarefas[i];
                var novaTarefa = document.createElement("li");

                // Verifica se a tarefa está vencida
                var dataVencimento = new Date(tarefa.dataVencimento);
                var hoje = new Date();
                if (dataVencimento < hoje) {
                    novaTarefa.classList.add("tarefaVencida");
                }

                novaTarefa.innerHTML = `<span style="color: ${tarefa.prioridade};"> Acontecido: ${tarefa.tarefa} - OS ${tarefa.numeroOs} - Setor: ${tarefa.textoConcatenar} - Tarefa: ${tarefa.responsavel} - Vencimento: ${tarefa.dataVencimento}</span>`;

                var botaoRealizada = document.createElement("button");

                botaoRealizada.innerText = "Iniciar Atividade";
                botaoRealizada.onclick = function(index) {
                    return function() {
                        marcarTarefaEmAndamento(index);
                    }
                }(i);
                novaTarefa.appendChild(botaoRealizada);
                listaTarefas.appendChild(novaTarefa);
            }
        }

        // Função para exibir as atividades em andamento na lista
        function exibirAtividadesEmAndamento() {
            var listaAtividadesEmAndamento = document.getElementById("listaAtividadesEmAndamento");
            listaAtividadesEmAndamento.innerHTML = "";

            for (var i = 0; i < atividadesEmAndamento.length; i++) {
                var atividade = atividadesEmAndamento[i];
                var novaAtividade = document.createElement("li");
                novaAtividade.innerHTML = `<span style="color: ${atividade.prioridade};">Acontecido: ${atividade.tarefa} - OS ${atividade.numeroOs} - Setor: ${atividade.textoConcatenar} - Tarefa: ${atividade.responsavel} - Vencimento: ${atividade.dataVencimento}</span>`;
                var botaoCadastrarAtividade = document.createElement("button");
                botaoCadastrarAtividade.innerText = "Finalizar Atividade";
                botaoCadastrarAtividade.onclick = function(index) {
                    return function() {
                        cadastrarAtividade(index);
                    }
                }(i);
                novaAtividade.appendChild(botaoCadastrarAtividade);
                listaAtividadesEmAndamento.appendChild(novaAtividade);
            }
        }

        // Função para exibir as atividades realizadas na lista
        function exibirAtividadesRealizadas() {
            var listaAtividadesRealizadas = document.getElementById("listaAtividadesRealizadas");
            listaAtividadesRealizadas.innerHTML = "";

            for (var i = 0; i < atividadesRealizadas.length; i++) {
                var atividadeRealizada = atividadesRealizadas[i];
                var novaAtividadeRealizada = document.createElement("li");
                novaAtividadeRealizada.innerHTML = `<span class="tarefaRealizada"> Acontecido: ${atividadeRealizada.tarefa} - OS ${atividadeRealizada.numeroOs} - Setor: ${atividadeRealizada.textoConcatenar} - Tarefa: ${atividadeRealizada.responsavel} - Vencimento: ${atividadeRealizada.dataVencimento}</span>`;
                var botaoApagar = document.createElement("button");
                botaoApagar.innerText = "Apagar";
                botaoApagar.onclick = function(index) {
                    return function() {
                        apagarAtividadeRealizada(index);
                    }
                }(i);
                novaAtividadeRealizada.appendChild(botaoApagar);
                listaAtividadesRealizadas.appendChild(novaAtividadeRealizada);
            }
        }

        // Função para marcar uma tarefa como em andamento
        function marcarTarefaEmAndamento(index) {
            var tarefaEmAndamento = tarefas.splice(index, 1)[0];
            atividadesEmAndamento.push(tarefaEmAndamento);
            salvarTarefas();
            salvarAtividadesEmAndamento();
            exibirTarefas();
            exibirAtividadesEmAndamento();
        }

        // Função para cadastrar uma atividade em andamento
        function cadastrarAtividade(index) {
            var atividade = atividadesEmAndamento.splice(index, 1)[0];
            atividadesRealizadas.push(atividade);
            salvarAtividadesRealizadas();
            exibirAtividadesEmAndamento();
            exibirAtividadesRealizadas();
        }

        // Função para apagar uma atividade realizada específica
        function apagarAtividadeRealizada(index) {
            atividadesRealizadas.splice(index, 1);
            salvarAtividadesRealizadas();
            exibirAtividadesRealizadas();
        }

        function adicionarOuConcatenarTarefa() {
            var tarefa = document.getElementById("tarefa").value;
            if (tarefa === "") {
                alert("Por favor, digite uma tarefa.");
                return;
            }

            // Obtém a prioridade atual selecionada
            var prioridade = document.getElementById("prioridade").value;

            // Obtém o número de OS
            var numeroOs = document.getElementById("numeroOs").value;

            // Obtém o texto para concatenar
            var textoConcatenar = document.getElementById("placeholderConcatenar").value;

            // Obtém a data de vencimento
            var dataVencimento = document.getElementById("dataVencimento").value;

            // Adiciona a tarefa ao array
            tarefas.push({ tarefa, prioridade, numeroOs, textoConcatenar, dataVencimento });

            // Salva as tarefas no Local Storage
            salvarTarefas();

            // Limpa os campos de entrada
            document.getElementById("tarefa").value = "";
            document.getElementById("numeroOs").value = "";
            document.getElementById("placeholderConcatenar").value = "";
            document.getElementById("dataVencimento").value = ""; // Limpa o campo de data de vencimento

            // Atualiza o placeholder do input de responsável para "Tarefas"
            document.getElementById("responsavelInput").placeholder = "Tarefa:";

            // Atualiza a lista de tarefas
            exibirTarefas();
        }

        function definirPrioridade(cor) {
            document.getElementById("prioridade").value = cor;

            // Define a classe de prioridade selecionada para o botão atual
            document.getElementById("prioridadeAlta").classList.remove("prioridadeSelecionada");
            document.getElementById("prioridadeMedia").classList.remove("prioridadeSelecionada");
            document.getElementById("prioridadeBaixa").classList.remove("prioridadeSelecionada");

            if (cor === 'red') {
                document.getElementById("prioridadeAlta").classList.add("prioridadeSelecionada");
            } else if (cor === 'yellow') {
                document.getElementById("prioridadeMedia").classList.add("prioridadeSelecionada");
            } else {
                document.getElementById("prioridadeBaixa").classList.add("prioridadeSelecionada");
            }
        }

        // Carrega as tarefas do Local Storage ao carregar a página
        carregarTarefas();
        carregarAtividadesEmAndamento();
        carregarAtividadesRealizadas();
    </script>
</body>
</html>
